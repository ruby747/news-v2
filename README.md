# Magic Patterns - Vite Template

This code was generated by [Magic Patterns](https://magicpatterns.com) for this design: [Source Design](https://www.magicpatterns.com/c/5wrjyxxd51tkeejgghvkwx)

## Getting Started (Frontend)

1. Run `npm install`
2. Run `npm run dev`

## Pages-Only: Static + Scheduled Build

완전 정적(서버 없음) 배포를 위해 GitHub Actions가 일정 간격으로 RSS를 수집하고 임베딩/클러스터링을 수행한 결과(`public/topics.json`)를 빌드 산출물에 포함합니다. 프론트는 우선 `topics.json`을 사용합니다.

### Static Mode (GitHub Pages)

Frontend tries these in order on startup:
1) `GET {BASE_URL}/topics.json` – Actions가 생성한 정적 데이터 사용
2) `GET {VITE_API_BASE}/api/topics` – 선택적 서버가 있으면 사용
3) `GET {VITE_API_BASE}/api/news/kr` – 있으면 브라우저에서 토픽 계산(로컬 임베딩)
4) Fallback to mock data

선택) 외부 API가 있으면 환경변수로 설정(예시):

```
VITE_API_BASE=https://example.com
```

하위 경로 배포 시 base 경로 설정:

```
VITE_BASE=/your-repo/
```

커스텀 도메인: 필요 시 `public/CNAME` 파일을 만들고 원하는 도메인명을 넣어주세요. GitHub Pages 설정에서도 동일 도메인을 지정해야 합니다.

### GitHub Actions로 자동 빌드/배포

`.github/workflows/pages.yml`가 포함되어 있습니다. main 브랜치 푸시, 수동 트리거, 그리고 30분 간격으로 다음을 수행합니다:
- `scripts/build-topics.js`: RSS 수집 → 임베딩 → 클러스터링 → `public/topics.json` 생성
- `npm run build`: Vite 빌드
- GitHub Pages에 `dist/` 배포

필요시 Repository Settings → Pages → Build and deployment를 “GitHub Actions”로 바꿔주세요.

### Install and Run the Server (optional)

```
cd server
npm install
npm start
```

The server listens on `http://localhost:8787` and exposes:
- `GET /health` – health check
- `GET /api/news/kr` – raw Korean news articles
- `GET /api/topics` – topics + articles with cluster labels and explanations
- `POST /api/embed` – embed an array of texts locally

The frontend will try server topics first, then compute topics locally if only `/api/news/kr` is present.

### Offline notes

`@xenova/transformers` downloads the model on first run to a local cache. To control the cache location (and keep things offline after the first run), set `TRANSFORMERS_CACHE`:

```
export TRANSFORMERS_CACHE=~/.cache/transformers
```

Once downloaded, the model runs fully locally. No API keys are required.

### Korean sources

By default the server merges multiple feeds:
- Google News KR: `https://news.google.com/rss?hl=ko&gl=KR&ceid=KR:ko`
- Yonhap (연합뉴스): `https://www.yna.co.kr/rss/all.xml`
- KBS 주요뉴스: `https://news.kbs.co.kr/rss/news/major.xml`
- SBS 뉴스: `https://news.sbs.co.kr/news/rss/news.xml`

Override via env var (comma-separated):

```
FEEDS="https://example.com/rss1.xml,https://example.com/rss2.xml" npm start
```

Basic thumbnail extraction is supported from `enclosure`, `media:*`, or the first `<img>` in content, and favicons are inferred from the article domain.

## UI Tweaks

The Top 10 topics list spacing has been tightened (`src/components/TopicRankings.tsx`).
